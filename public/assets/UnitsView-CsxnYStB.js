import{g as v,p as ne,h as ie,i as ae,c as a,b as t,k as _,e as O,j as z,q as k,x as T,F as D,l as H,v as F,t as u,s as q,y as de,z as ue,A as I,o as d,n as R}from"./index-klw2IyYl.js";const ce={class:"max-w-6xl mx-auto p-6 bg-white min-h-screen"},pe={class:"flex justify-between items-center mb-6"},ve={class:"flex items-center gap-4"},xe=["disabled"],ge={class:"flex items-center gap-4"},fe=["value"],me={key:0,class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg"},ye={class:"flex items-center"},be={class:"text-red-700"},he={key:1,class:"flex justify-center py-12"},we={key:2,class:"bg-white rounded-lg shadow overflow-hidden"},Ce={class:"overflow-x-auto"},ke={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-white divide-y divide-gray-200"},Se={key:0},Ve={colspan:"6",class:"px-6 py-12 text-center text-gray-500"},Ae={class:"text-sm"},Ue={class:"px-6 py-4"},_e={class:"text-sm font-medium text-gray-900"},Me={class:"text-sm text-gray-500 max-w-xs truncate"},Be={class:"px-6 py-4 whitespace-nowrap"},je={class:"text-sm text-gray-900"},De={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},Le={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},$e={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Oe={class:"flex justify-end gap-2"},ze=["onClick"],He=["onClick","title"],qe={key:0,class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ne={key:1,class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Pe=["onClick"],Te={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Re={class:"bg-white rounded-lg max-w-2xl w-full max-h-90vh overflow-y-auto"},Qe={class:"p-6 border-b"},Ge={class:"flex justify-between items-center"},Je={class:"text-xl font-semibold"},Ke={class:"p-6"},We=["value"],Xe={class:"flex items-center"},Ye={class:"flex justify-end gap-2 pt-4"},Ze=["disabled"],et={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},tt={class:"bg-white p-6 rounded-lg max-w-md w-full mx-4"},st={key:0,class:"mb-4 p-3 bg-gray-50 rounded"},ot={class:"text-sm text-gray-600"},lt={class:"flex gap-3"},rt=["disabled"],at={__name:"UnitsView",setup(nt){const c=v([]),M=v([]),m=v(!1),x=v(null),A=v(""),y=v(""),B=v(!1),S=v(null),L=v(!1),b=v(null),U=v(null),r=ne({id:null,title:"",description:"",courseId:"",order:1,isActive:!0}),N=ie(()=>{let o=c.value;if(y.value&&(o=o.filter(e=>e.courseId===y.value)),A.value){const e=A.value.toLowerCase();o=o.filter(s=>s.title.toLowerCase().includes(e)||s.description?.toLowerCase().includes(e))}return o}),Q=o=>{const e=M.value.find(s=>s.id===o);return e?e.title:"Unknown Course"},G=async()=>{try{const o=await ue.getAll();M.value=o}catch(o){console.error("Error loading courses:",o)}},j=async()=>{m.value=!0,x.value=null;try{let o;y.value?o=await I.getByCourse(y.value):o=await I.getAll(),c.value=o}catch(o){console.error("Error loading units:",o),x.value="Failed to load units"}finally{m.value=!1}},J=()=>{r.id=null,r.title="",r.description="",r.courseId=y.value||"",r.order=1,r.isActive=!0},K=o=>{Object.assign(r,o),S.value=o,B.value=!1},E=()=>{B.value=!1,S.value=null,J()},W=async()=>{m.value=!0,x.value=null;try{if(S.value){const o=await I.update(r.id,r),e=c.value.findIndex(s=>s.id===r.id);e>-1&&(c.value[e]=o)}else{const o=await I.create(r);c.value.unshift(o)}E()}catch(o){console.error("Error saving unit:",o),x.value="Failed to save unit"}finally{m.value=!1}},X=async o=>{try{const e=await I.update(o.id,{...o,isActive:!o.isActive}),s=c.value.findIndex(l=>l.id===o.id);s>-1&&(c.value[s]=e)}catch(e){console.error("Error updating unit status:",e),x.value="Failed to update unit status"}},Y=async o=>{if(confirm(`Are you sure you want to delete "${o.title}"?`))try{await I.delete(o.id);const e=c.value.findIndex(s=>s.id===o.id);e>-1&&c.value.splice(e,1)}catch(e){console.error("Error deleting unit:",e),x.value="Failed to delete unit"}},Z=()=>{if(!c.value||c.value.length===0){alert("No units to export");return}const e=[["title","description","courseId","order","isActive"].join(","),...c.value.map(n=>[`"${(n.title||"").replace(/"/g,'""')}"`,`"${(n.description||"").replace(/"/g,'""')}"`,n.courseId||"",n.order||"",n.isActive?"true":"false"].join(","))].join(`
`),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),i=URL.createObjectURL(s);l.setAttribute("href",i),l.setAttribute("download",`units_${new Date().toISOString().split("T")[0]}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},ee=()=>{L.value=!0},P=()=>{L.value=!1,b.value=null,U.value&&(U.value.value="")},te=o=>{const e=o.target.files[0];e&&e.type==="text/csv"?b.value=e:alert("Please select a valid CSV file")},se=o=>{o.preventDefault();const e=o.dataTransfer.files[0];e&&e.type==="text/csv"?(b.value=e,U.value&&(U.value.files=o.dataTransfer.files)):alert("Please drop a valid CSV file")},oe=()=>{const e=[["title","description","courseId","order","isActive"],["Unit 1: Introduction","Basic concepts and fundamentals","1","1","true"],["Unit 2: Advanced Topics","Deep dive into complex subjects","1","2","true"],["Unit 3: Practice","Hands-on exercises and examples","1","3","true"]].map(n=>n.map(p=>`"${p}"`).join(",")).join(`
`),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),i=URL.createObjectURL(s);l.setAttribute("href",i),l.setAttribute("download","units_sample_template.csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)},le=o=>{const e=[];let s="",l=!1;for(let i=0;i<o.length;i++){const n=o[i],p=o[i+1];n==='"'?l&&p==='"'?(s+='"',i++):l=!l:n===`
`&&!l?(s.trim()&&e.push(s),s=""):s+=n}return s.trim()&&e.push(s),e.map(i=>{const n=[];let p="",h=!1;for(let g=0;g<i.length;g++){const w=i[g],V=i[g+1];w==='"'?h&&V==='"'?(p+='"',g++):h=!h:w===","&&!h?(n.push(p),p=""):p+=w}return n.push(p),n})},re=async()=>{if(!b.value){alert("Please select a CSV file");return}try{const o=await b.value.text(),e=le(o);if(e.length<2){alert("CSV file must contain at least a header row and one data row");return}const s=e[0].map(C=>C.toLowerCase().trim()),i=["title","description"].filter(C=>!s.includes(C));if(i.length>0){alert(`Missing required columns: ${i.join(", ")}`);return}const n=s.indexOf("title"),p=s.indexOf("description"),h=s.indexOf("courseid"),g=s.indexOf("order");let w=0,V=0;for(let C=1;C<e.length;C++){const f=e[C];if(f.length<s.length||!f[n]||!f[p]){V++;continue}try{const $={title:f[n].trim(),description:f[p].trim(),courseId:h>=0&&f[h]?f[h]:y.value||null,order:g>=0&&f[g]?parseInt(f[g]):1,isActive:!0};await I.create($),w++}catch($){console.error("Error creating unit:",$),V++}}P(),await j(),w>0?alert(`Successfully imported ${w} units${V>0?`. ${V} units failed to import.`:"."}`):alert("No units were imported. Please check your CSV format.")}catch(o){console.error("Error importing CSV:",o),alert("Error reading CSV file. Please check the file format.")}};return ae(()=>{G(),j()}),(o,e)=>(d(),a(D,null,[t("div",ce,[e[34]||(e[34]=t("div",{class:"bg-gradient-to-r from-green-600 to-blue-600 text-white p-6 rounded-lg mb-6"},[t("h1",{class:"text-3xl font-bold mb-2"},"Units Management"),t("p",{class:"text-green-100"},"Organize course content into units")],-1)),t("div",pe,[t("div",ve,[t("button",{onClick:e[0]||(e[0]=s=>B.value=!0),class:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition flex items-center gap-2"},e[12]||(e[12]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"m12 5v14m-7-7h14"})],-1),O(" Add Unit ")])),t("button",{onClick:Z,class:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2"},e[13]||(e[13]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7,10 12,15 17,10"}),t("line",{x1:"12",x2:"12",y1:"15",y2:"3"})],-1),O(" Export CSV ")])),t("button",{onClick:ee,class:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition flex items-center gap-2"},e[14]||(e[14]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"17,8 12,3 7,8"}),t("line",{x1:"12",x2:"12",y1:"3",y2:"15"})],-1),O(" Import CSV ")])),t("button",{onClick:j,disabled:m.value,class:"bg-gray-600 text-white px-6 flex items-center py-2 rounded-lg hover:bg-gray-700 transition disabled:opacity-50"},e[15]||(e[15]=[z('<svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M3 21v-5h5"></path></svg> Refresh ',2)]),8,xe)]),t("div",ge,[k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),onChange:j,class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[e[16]||(e[16]=t("option",{value:""},"All Courses",-1)),(d(!0),a(D,null,H(M.value,s=>(d(),a("option",{key:s.id,value:s.id},u(s.title),9,fe))),128))],544),[[T,y.value]]),k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>A.value=s),type:"text",placeholder:"Search units...",class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[F,A.value]])])]),x.value?(d(),a("div",me,[t("div",ye,[e[18]||(e[18]=t("svg",{class:"w-5 h-5 text-red-400 mr-2",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})],-1)),t("span",be,u(x.value),1),t("button",{onClick:e[3]||(e[3]=s=>x.value=null),class:"ml-auto text-red-400 hover:text-red-600"},e[17]||(e[17]=[t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)]))])])):_("",!0),m.value?(d(),a("div",he,e[19]||(e[19]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1)]))):(d(),a("div",we,[t("div",Ce,[t("table",ke,[e[26]||(e[26]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Course"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Order"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Lessons"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",Ie,[N.value.length===0?(d(),a("tr",Se,[t("td",Ve,[e[20]||(e[20]=t("svg",{class:"w-12 h-12 mx-auto mb-4 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),t("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})],-1)),e[21]||(e[21]=t("p",{class:"text-lg font-medium mb-2"},"No units found",-1)),t("p",Ae,u(A.value?"Try adjusting your search terms":"Create your first unit to get started"),1)])])):_("",!0),(d(!0),a(D,null,H(N.value,s=>(d(),a("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Ue,[t("div",null,[t("div",_e,u(s.title),1),t("div",Me,u(s.description||"No description"),1)])]),t("td",Be,[t("div",je,u(Q(s.courseId)),1)]),t("td",De,[t("span",Fe,u(s.order),1)]),t("td",Le,[t("span",{class:R([s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800","inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},u(s.isActive?"Active":"Inactive"),3)]),t("td",Ee,u(s.lessonCount||0)+" lessons ",1),t("td",$e,[t("div",Oe,[t("button",{onClick:l=>K(s),class:"text-blue-600 hover:text-blue-900 p-1",title:"Edit"},e[22]||(e[22]=[t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1"}),t("path",{d:"M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3l8.385-8.415z"}),t("path",{d:"m16 5 3 3"})],-1)]),8,ze),t("button",{onClick:l=>X(s),class:R([s.isActive?"text-gray-600 hover:text-gray-900":"text-green-600 hover:text-green-900","p-1"]),title:s.isActive?"Deactivate":"Activate"},[s.isActive?(d(),a("svg",qe,e[23]||(e[23]=[t("path",{d:"M10 9V6a4 4 0 1 1 8 0v3"},null,-1),t("rect",{x:"8",y:"9",width:"12",height:"9",rx:"2"},null,-1)]))):(d(),a("svg",Ne,e[24]||(e[24]=[t("rect",{x:"8",y:"9",width:"12",height:"9",rx:"2"},null,-1),t("path",{d:"M16 9V6a4 4 0 0 0-8 0v3"},null,-1)])))],10,He),t("button",{onClick:l=>Y(s),class:"text-red-600 hover:text-red-900 p-1",title:"Delete"},e[25]||(e[25]=[z('<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3,6 5,6 21,6"></polyline><path d="m19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>',1)]),8,Pe)])])]))),128))])])])])),B.value||S.value?(d(),a("div",Te,[t("div",Re,[t("div",Qe,[t("div",Ge,[t("h3",Je,u(S.value?"Edit Unit":"Create New Unit"),1),t("button",{onClick:E,class:"text-gray-400 hover:text-gray-600"},e[27]||(e[27]=[t("svg",{class:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",x2:"6",y1:"6",y2:"18"}),t("line",{x1:"6",x2:"18",y1:"6",y2:"18"})],-1)]))])]),t("div",Ke,[t("form",{onSubmit:q(W,["prevent"]),class:"space-y-4"},[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Course *",-1)),k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>r.courseId=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"},[e[28]||(e[28]=t("option",{value:""},"Select a course",-1)),(d(!0),a(D,null,H(M.value,s=>(d(),a("option",{key:s.id,value:s.id},u(s.title),9,We))),128))],512),[[T,r.courseId]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Title *",-1)),k(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>r.title=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Enter unit title"},null,512),[[F,r.title]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Description",-1)),k(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>r.description=s),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Enter unit description"},null,512),[[F,r.description]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Order",-1)),k(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=s=>r.order=s),min:"1",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Unit order (1, 2, 3...)"},null,512),[[F,r.order,void 0,{number:!0}]])]),t("div",null,[t("label",Xe,[k(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>r.isActive=s),class:"rounded border-gray-300 text-green-600 shadow-sm focus:border-green-300 focus:ring focus:ring-green-200 focus:ring-opacity-50"},null,512),[[de,r.isActive]]),e[33]||(e[33]=t("span",{class:"ml-2 text-sm text-gray-700"},"Unit is active",-1))])]),t("div",Ye,[t("button",{type:"button",onClick:E,class:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition"}," Cancel "),t("button",{type:"submit",disabled:m.value,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition disabled:opacity-50"},u(m.value?"Saving...":S.value?"Update":"Create"),9,Ze)])],32)])])])):_("",!0)]),L.value?(d(),a("div",et,[t("div",tt,[e[38]||(e[38]=t("h3",{class:"text-lg font-semibold mb-4"},"Import Units from CSV",-1)),t("div",{onDragover:e[10]||(e[10]=q(()=>{},["prevent"])),onDragenter:e[11]||(e[11]=q(()=>{},["prevent"])),onDrop:se,class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center mb-4 hover:border-blue-400 transition"},[e[35]||(e[35]=z('<div class="mb-4"><svg class="w-12 h-12 mx-auto text-gray-400 mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17,8 12,3 7,8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg><p class="text-gray-600">Drop your CSV file here or</p></div>',1)),t("button",{onClick:e[9]||(e[9]=s=>o.$refs.csvFileInput.click()),class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"}," Choose File "),t("input",{ref_key:"csvFileInput",ref:U,type:"file",accept:".csv",onChange:te,class:"hidden"},null,544)],32),b.value?(d(),a("div",st,[t("p",ot,"Selected file: "+u(b.value.name),1)])):_("",!0),t("div",{class:"mb-4"},[e[36]||(e[36]=t("h4",{class:"font-medium mb-2"},"CSV Format Requirements:",-1)),e[37]||(e[37]=t("ul",{class:"text-sm text-gray-600 space-y-1"},[t("li",null,"• First row should be headers"),t("li",null,"• Required columns: title, description"),t("li",null,"• Optional columns: courseId, order, isActive")],-1)),t("button",{onClick:oe,class:"text-blue-600 hover:underline text-sm mt-2"}," Download sample CSV template ")]),t("div",lt,[t("button",{onClick:P,class:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400"}," Cancel "),t("button",{onClick:re,disabled:!b.value,class:"flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50"}," Import ",8,rt)])])])):_("",!0)],64))}};export{at as default};
